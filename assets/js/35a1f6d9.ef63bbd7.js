"use strict";(self.webpackChunkkarunjosyin=self.webpackChunkkarunjosyin||[]).push([[976],{7403:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var t=s(4848),r=s(8453);const o={},i=void 0,c={id:"CephBox/ente",title:"ente",description:"#",source:"@site/docs/CephBox/ente.md",sourceDirName:"CephBox",slug:"/CephBox/ente",permalink:"/docs/CephBox/ente",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CephBox/ente.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Architecture",permalink:"/docs/CephBox/Architecture"}},l={},d=[{value:"Ente desktop app",id:"ente-desktop-app",level:4},{value:"Deploying Ente Musuem server with Postgress",id:"deploying-ente-musuem-server-with-postgress",level:4}];function a(e){const n={a:"a",h1:"h1",h4:"h4",li:"li",ol:"ol",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"#############\nente with ceph setup\n###############"}),"\n",(0,t.jsx)(n.p,{children:"Three Components:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Ente desktop app"}),"\n",(0,t.jsx)(n.li,{children:"Ente Musuem server with Postgress"}),"\n",(0,t.jsx)(n.li,{children:"Ceph RGW external"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"ente-desktop-app",children:"Ente desktop app"}),"\n",(0,t.jsxs)(n.p,{children:["Download the desktop app ",(0,t.jsx)(n.a,{href:"https://ente.photos/",children:"https://ente.photos/"})]}),"\n",(0,t.jsx)(n.h4,{id:"deploying-ente-musuem-server-with-postgress",children:"Deploying Ente Musuem server with Postgress"}),"\n",(0,t.jsxs)(n.p,{children:["Reference : ",(0,t.jsx)(n.a,{href:"https://github.com/ente-io/ente/blob/main/server/docs/docker.md",children:"https://github.com/ente-io/ente/blob/main/server/docs/docker.md"})]}),"\n",(0,t.jsx)(n.p,{children:"Steps:"}),"\n",(0,t.jsx)(n.h1,{id:"create-a-directory-where-youll-run-ente",children:"Create a directory where you'll run Ente"}),"\n",(0,t.jsx)(n.p,{children:"mkdir ente && cd ente"}),"\n",(0,t.jsx)(n.h1,{id:"copy-the-starter-composeyaml-and-two-of-its-support-files-from-the-repository-onto-your-directory-you-can-do-it-by-hand-or-use-eg-curl",children:"Copy the starter compose.yaml and two of its support files from the repository onto your directory. You can do it by hand, or use (e.g.) curl"}),"\n",(0,t.jsx)(n.h1,{id:"composeyaml",children:"compose.yaml"}),"\n",(0,t.jsxs)(n.p,{children:["curl -LO ",(0,t.jsx)(n.a,{href:"https://raw.githubusercontent.com/ente-io/ente/main/server/compose.yaml",children:"https://raw.githubusercontent.com/ente-io/ente/main/server/compose.yaml"})]}),"\n",(0,t.jsx)(n.p,{children:"mkdir -p scripts/compose\ncd scripts/compose"}),"\n",(0,t.jsx)(n.h1,{id:"scriptscomposecredentialsyaml",children:"scripts/compose/credentials.yaml"}),"\n",(0,t.jsxs)(n.p,{children:["curl -LO ",(0,t.jsx)(n.a,{href:"https://raw.githubusercontent.com/ente-io/ente/main/server/scripts/compose/credentials.yaml",children:"https://raw.githubusercontent.com/ente-io/ente/main/server/scripts/compose/credentials.yaml"})]}),"\n",(0,t.jsx)(n.h1,{id:"scriptscomposeminio-provisionsh",children:"scripts/compose/minio-provision.sh"}),"\n",(0,t.jsxs)(n.p,{children:["curl -LO ",(0,t.jsx)(n.a,{href:"https://raw.githubusercontent.com/ente-io/ente/main/server/scripts/compose/minio-provision.sh",children:"https://raw.githubusercontent.com/ente-io/ente/main/server/scripts/compose/minio-provision.sh"})]}),"\n",(0,t.jsx)(n.p,{children:"cd ../.."}),"\n",(0,t.jsx)(n.h1,{id:"modify-composeyaml-as",children:"Modify compose.yaml as"}),"\n",(0,t.jsx)(n.h1,{id:"cat-composeyaml",children:"cat compose.yaml"}),"\n",(0,t.jsx)(n.p,{children:"services:\nmuseum:\nimage: ghcr.io/ente-io/server\nports:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"8080:8080 # API"}),"\n",(0,t.jsx)(n.li,{children:"2112:2112 # Prometheus metrics\ndepends_on:\npostgres:\ncondition: service_healthy\nenvironment:"}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"pass-in-the-config-to-connect-to-the-db-and-minio",children:"Pass-in the config to connect to the DB and MinIO"}),"\n",(0,t.jsx)(n.p,{children:"ENTE_CREDENTIALS_FILE: /credentials.yaml\nvolumes:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"custom-logs:/var/logs"}),"\n",(0,t.jsxs)(n.li,{children:["./museum.yaml:/museum.yaml",":ro"]}),"\n",(0,t.jsxs)(n.li,{children:["./scripts/compose/credentials.yaml:/credentials.yaml",":ro"]}),"\n",(0,t.jsxs)(n.li,{children:["./data:/data",":ro","\nnetworks:"]}),"\n",(0,t.jsx)(n.li,{children:"internal"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"postgres:\nimage: postgres:15\nports:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"5432:5432\nenvironment:\nPOSTGRES_USER: pguser\nPOSTGRES_PASSWORD: pgpass\nPOSTGRES_DB: ente_db"}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"wait-for-postgres-to-be-accept-connections-before-starting-museum",children:"Wait for postgres to be accept connections before starting museum."}),"\n",(0,t.jsx)(n.p,{children:'healthcheck:\ntest:\n[\n"CMD",\n"pg_isready",\n"-q",\n"-d",\n"ente_db",\n"-U",\n"pguser"\n]\nstart_period: 40s\nstart_interval: 1s\nvolumes:'}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"postgres-data:/var/lib/postgresql/data\nnetworks:"}),"\n",(0,t.jsx)(n.li,{children:"internal\nvolumes:\ncustom-logs:\npostgres-data:\nminio-data:"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"networks:\ninternal:"}),"\n",(0,t.jsx)(n.h1,{id:"edit-the-scriptscomposecredentialsyaml-to-add-these-details",children:"Edit the scripts/compose/credentials.yaml to add these details:"}),"\n",(0,t.jsx)(n.p,{children:"s3:\nare_local_buckets: true\nb2-eu-cen:\nkey: test\nsecret: testtest\nendpoint: 10.74.128.169:80\nregion: eu-central-2\nbucket: test"})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var t=s(6540);const r={},o=t.createContext(r);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);
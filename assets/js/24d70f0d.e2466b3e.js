"use strict";(self.webpackChunkkarunjosyin=self.webpackChunkkarunjosyin||[]).push([[7696],{70:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>b,frontMatter:()=>o,metadata:()=>d,toc:()=>i});var t=a(4848),s=a(8453);const o={},c=void 0,d={id:"Explained/RGW/RGW Object lookup path",title:"RGW Object lookup path",description:"How does the object lookup works in RGW?",source:"@site/docs/Explained/RGW/RGW Object lookup path.md",sourceDirName:"Explained/RGW",slug:"/Explained/RGW/RGW Object lookup path",permalink:"/docs/Explained/RGW/RGW Object lookup path",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"cephExplainedSidebar",previous:{title:"RGW Command cheatsheet",permalink:"/docs/Explained/RGW/RGW Command cheatsheet"}},r={},i=[{value:"How does the object lookup works in RGW?",id:"how-does-the-object-lookup-works-in-rgw",level:2}];function l(e){const n={code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"how-does-the-object-lookup-works-in-rgw",children:"How does the object lookup works in RGW?"}),"\n",(0,t.jsx)(n.p,{children:"When accessing S3 objects, REST APIs come to RGW with three parameters:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"account information (access key in S3),"}),"\n",(0,t.jsx)(n.li,{children:"bucket name,"}),"\n",(0,t.jsx)(n.li,{children:"and object name (or key)."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["When accessing a user\u2019s data, the user record is loaded from an object named ",(0,t.jsx)(n.code,{children:"<user_id>"})," in pool default.rgw.meta with namespace users.uid\nThis namespace will have the username and username.buckets objects:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"#  rados -p kerala.rgw.meta --namespace users.uid ls\ndashboard\nkj\nkj.buckets\ndashboard.buckets\n"})}),"\n",(0,t.jsx)(n.p,{children:"The list of buckets associated with a username is saved in the omap of the username.buckets object:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"#  rados -p kerala.rgw.meta --namespace users.uid listomapkeys kj.buckets\nkjbucket\ntest\n"})}),"\n",(0,t.jsx)(n.p,{children:"Bucket ID or marker of buckets is stored in the pool default.rgw.meta with namespace root"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# rados -p kerala.rgw.meta --namespace root ls\n.bucket.meta.test:1847c1d2-a429-4a01-a65b-30eac3893e1e.245100.2\n.bucket.meta.kjbucket:1847c1d2-a429-4a01-a65b-30eac3893e1e.115075.1\nkjbucket\ntest\n"})}),"\n",(0,t.jsxs)(n.p,{children:["S3 objects are located in a pool named like default.rgw.buckets.data.\nRADOS object names are ",(0,t.jsx)(n.code,{children:"<marker>_<key>"}),",  where ",(0,t.jsx)(n.em,{children:"marker"})," is the bucket ID and ",(0,t.jsx)(n.em,{children:"key"})," is the s3 object name\nExample : 1847c1d2-a429-4a01-a65b-30eac3893e1e.115075.1_10mb_object"]}),"\n",(0,t.jsxs)(n.p,{children:["An RGW object may comprise multiple RADOS objects, the first of which is the ",(0,t.jsx)(n.em,{children:"HEAD"})," that contains metadata including manifest, ACLs, content type, ETag, and user-defined metadata."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# for i in $(rados -p kerala.rgw.buckets.data listxattr 1847c1d2-a429-4a01-a65b-30eac3893e1e.115075.1_object1); do echo $i && rados -p kerala.rgw.buckets.data getxattr 1847c1d2-a429-4a01-a65b-30eac3893e1e.115075.1_10mb_object $i  | hexdump -C ; done\nuser.rgw.acl\n00000000  02 02 6f 00 00 00 03 02  0c 00 00 00 02 00 00 00  |..o.............|\n00000010  6b 6a 02 00 00 00 6b 6a  04 03 57 00 00 00 01 01  |kj....kj..W.....|\n00000020  00 00 00 02 00 00 00 6b  6a 0f 00 00 00 01 00 00  |.......kj.......|\n00000030  00 02 00 00 00 6b 6a 05  03 30 00 00 00 02 02 04  |.....kj..0......|\n00000040  00 00 00 00 00 00 00 02  00 00 00 6b 6a 00 00 00  |...........kj...|\n00000050  00 00 00 00 00 02 02 04  00 00 00 0f 00 00 00 02  |................|\n00000060  00 00 00 6b 6a 00 00 00  00 00 00 00 00 00 00 00  |...kj...........|\n00000070  00 00 00 00 00 0a                                 |......|\n00000076\nuser.rgw.content_type\n00000000  61 70 70 6c 69 63 61 74  69 6f 6e 2f 6f 63 74 65  |application/octe|\n00000010  74 2d 73 74 72 65 61 6d  00 0a                    |t-stream..|\n0000001a\nuser.rgw.etag\n00000000  66 31 63 39 36 34 35 64  62 63 31 34 65 66 64 64  |f1c9645dbc14efdd|\n00000010  63 37 64 38 61 33 32 32  36 38 35 66 32 36 65 62  |c7d8a322685f26eb|\n00000020  0a                                                |.|\n00000021\nuser.rgw.idtag\n00000000  31 38 34 37 63 31 64 32  2d 61 34 32 39 2d 34 61  |1847c1d2-a429-4a|\n00000010  30 31 2d 61 36 35 62 2d  33 30 65 61 63 33 38 39  |01-a65b-30eac389|\n00000020  33 65 31 65 2e 32 34 35  31 30 30 2e 36 37 38 37  |3e1e.245100.6787|\n00000030  37 36 39 33 34 33 39 35  37 35 39 37 38 36 33 00  |769343957597863.|\n00000040  0a                                                |.|\n00000041\nuser.rgw.manifest\n00000000  08 06 61 01 00 00 00 00  a0 00 00 00 00 00 00 00  |..a.............|\n00000010  00 00 00 06 06 90 00 00  00 0a 0a 73 00 00 00 08  |...........s....|\n00000020  00 00 00 6b 6a 62 75 63  6b 65 74 2d 00 00 00 31  |...kjbucket-...1|\n00000030  38 34 37 63 31 64 32 2d  61 34 32 39 2d 34 61 30  |847c1d2-a429-4a0|\n00000040  31 2d 61 36 35 62 2d 33  30 65 61 63 33 38 39 33  |1-a65b-30eac3893|\n00000050  65 31 65 2e 31 31 35 30  37 35 2e 31 2d 00 00 00  |e1e.115075.1-...|\n00000060  31 38 34 37 63 31 64 32  2d 61 34 32 39 2d 34 61  |1847c1d2-a429-4a|\n00000070  30 31 2d 61 36 35 62 2d  33 30 65 61 63 33 38 39  |01-a65b-30eac389|\n00000080  33 65 31 65 2e 31 31 35  30 37 35 2e 31 00 00 00  |3e1e.115075.1...|\n00000090  00 00 00 00 00 00 0b 00  00 00 31 30 6d 62 5f 6f  |..........10mb_o|\n000000a0  62 6a 65 63 74 00 00 00  00 00 00 40 00 00 00 00  |bject......@....|\n000000b0  00 00 00 40 00 00 00 00  00 21 00 00 00 2e 33 52  |...@.....!....3R|\n000000c0  58 59 56 6e 55 77 7a 6c  4e 78 5a 34 62 79 69 45  |XYVnUwzlNxZ4byiE|\n000000d0  36 36 50 67 62 30 35 39  33 66 79 64 48 5f 01 00  |66Pgb0593fydH_..|\n000000e0  00 00 00 00 00 00 00 00  00 00 02 01 20 00 00 00  |............ ...|\n000000f0  00 00 00 00 00 00 40 00  00 00 00 00 00 00 00 00  |......@.........|\n*\n00000110  00 00 11 00 00 00 64 65  66 61 75 6c 74 2d 70 6c  |......default-pl|\n00000120  61 63 65 6d 65 6e 74 11  00 00 00 64 65 66 61 75  |acement....defau|\n00000130  6c 74 2d 70 6c 61 63 65  6d 65 6e 74 00 00 00 00  |lt-placement....|\n00000140  02 02 21 00 00 00 04 00  00 00 6e 6f 6e 65 03 01  |..!.......none..|\n00000150  12 00 00 00 00 00 00 00  00 00 00 00 00 00 01 00  |................|\n00000160  00 00 00 00 00 00 00 0a                           |........|\n00000168\nuser.rgw.pg_ver\n00000000  0b 00 00 00 00 00 00 00  0a                       |.........|\n00000009\nuser.rgw.source_zone\n00000000  49 88 fa a4 0a                                    |I....|\n00000005\nuser.rgw.tail_tag\n00000000  31 38 34 37 63 31 64 32  2d 61 34 32 39 2d 34 61  |1847c1d2-a429-4a|\n00000010  30 31 2d 61 36 35 62 2d  33 30 65 61 63 33 38 39  |01-a65b-30eac389|\n00000020  33 65 31 65 2e 32 34 35  31 30 30 2e 36 37 38 37  |3e1e.245100.6787|\n00000030  37 36 39 33 34 33 39 35  37 35 39 37 38 36 33 00  |769343957597863.|\n00000040  0a                                                |.|\n00000041\nuser.rgw.x-amz-meta-s3cmd-attrs\n00000000  61 74 69 6d 65 3a 31 37  34 32 35 36 34 39 36 35  |atime:1742564965|\n00000010  2f 63 74 69 6d 65 3a 31  37 34 32 35 36 34 39 36  |/ctime:174256496|\n00000020  35 2f 67 69 64 3a 30 2f  67 6e 61 6d 65 3a 72 6f  |5/gid:0/gname:ro|\n00000030  6f 74 2f 6d 64 35 3a 66  31 63 39 36 34 35 64 62  |ot/md5:f1c9645db|\n00000040  63 31 34 65 66 64 64 63  37 64 38 61 33 32 32 36  |c14efddc7d8a3226|\n00000050  38 35 66 32 36 65 62 2f  6d 6f 64 65 3a 33 33 31  |85f26eb/mode:331|\n00000060  38 38 2f 6d 74 69 6d 65  3a 31 37 34 32 35 36 34  |88/mtime:1742564|\n00000070  39 36 35 2f 75 69 64 3a  30 2f 75 6e 61 6d 65 3a  |965/uid:0/uname:|\n00000080  72 6f 6f 74 00 0a                                 |root..|\n00000086\n"})}),"\n",(0,t.jsx)(n.p,{children:"The manifest which is stored as xattr as show above, describes how each RGW object is laid out across RADOS objects.\nAnother easy command to see the object manifest is :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'# radosgw-admin object manifest --bucket kjbucket --object 10mb_object\n{\n    "size": 10485760,\n    "objects": [\n        {\n            "index": 0,\n            "part_id": 0,\n            "stripe_id": 0,\n            "offset": 0,\n            "size": 4194304,\n            "raw_obj": {\n                "pool": "kerala.rgw.buckets.data",\n                "oid": "1847c1d2-a429-4a01-a65b-30eac3893e1e.115075.1_10mb_object",\n                "loc": ""\n            }\n        },\n        {\n            "index": 1,\n            "part_id": 0,\n            "stripe_id": 1,\n            "offset": 4194304,\n            "size": 4194304,\n            "raw_obj": {\n                "pool": "kerala.rgw.buckets.data",\n                "oid": "1847c1d2-a429-4a01-a65b-30eac3893e1e.115075.1__shadow_.3RXYVnUwzlNxZ4byiE66Pgb0593fydH_1",\n                "loc": ""\n            }\n        },\n        {\n            "index": 2,\n            "part_id": 0,\n            "stripe_id": 2,\n            "offset": 8388608,\n            "size": 4194304,\n            "raw_obj": {\n                "pool": "kerala.rgw.buckets.data",\n                "oid": "1847c1d2-a429-4a01-a65b-30eac3893e1e.115075.1__shadow_.3RXYVnUwzlNxZ4byiE66Pgb0593fydH_2",\n                "loc": ""\n            }\n        }\n    ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"So how does a Multipart read works?"}),"\n",(0,t.jsx)(n.p,{children:"When a request comes, it goes to the HEAD object.\nThe manifest stored as xattr in the HEAD object has the list of its shadow objects.\nThen RGW combines these objects."})]})}function b(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>c,x:()=>d});var t=a(6540);const s={},o=t.createContext(s);function c(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);
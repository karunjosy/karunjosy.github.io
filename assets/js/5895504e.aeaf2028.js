"use strict";(self.webpackChunkkarunjosyin=self.webpackChunkkarunjosyin||[]).push([[628],{2427:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>h});var o=n(4848),s=n(8453);const i={},r="Setup Nextcloud with Ceph RGW",l={id:"CephBox/CephBox - DIY setup/Setup Nextcloud with Ceph RGW",title:"Setup Nextcloud with Ceph RGW",description:"To store files and stuff except photos, I use Nextcloud (although it can be an overkill if you don't plan to use it for all it's features). There needs to be an app or platform like Ente Photos that provides the minimal functionality of Google Drive without the heavy baggage of a fully blown Cloud system like Nextcloud. (Atleast, I was not able to found any). Until we have that, Nextcloud is the best option.",source:"@site/docs/CephBox/CephBox - DIY setup/Setup Nextcloud with Ceph RGW.md",sourceDirName:"CephBox/CephBox - DIY setup",slug:"/CephBox/CephBox - DIY setup/Setup Nextcloud with Ceph RGW",permalink:"/docs/CephBox/CephBox - DIY setup/Setup Nextcloud with Ceph RGW",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CephBox/CephBox - DIY setup/Setup Nextcloud with Ceph RGW.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Setup Ente Photos app",permalink:"/docs/CephBox/CephBox - DIY setup/Setup Ente Photos app"},next:{title:"Automatic Setup",permalink:"/docs/CephBox/CephBox - DIY setup/Automatic Setup"}},a={},h=[{value:"Installation of Portainer",id:"installation-of-portainer",level:3},{value:"Installation of Nextcloud",id:"installation-of-nextcloud",level:3},{value:"Setup RGW S3 as primary storage",id:"setup-rgw-s3-as-primary-storage",level:3}];function c(e){const t={a:"a",br:"br",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"setup-nextcloud-with-ceph-rgw",children:"Setup Nextcloud with Ceph RGW"})}),"\n",(0,o.jsxs)(t.p,{children:["To store files and stuff except photos, I use ",(0,o.jsx)(t.a,{href:"https://nextcloud.com/",children:"Nextcloud"})," (although it can be an overkill if you don't plan to use it for all it's features). There needs to be an app or platform like Ente Photos that provides the minimal functionality of Google Drive without the heavy baggage of a fully blown Cloud system like Nextcloud. (Atleast, I was not able to found any). Until we have that, Nextcloud is the best option."]}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://www.portainer.io/",children:"Portainer"})," can be used to install and manage Nextcloud using templates provided by Pi-hosted.\nRefer ",(0,o.jsx)(t.a,{href:"https://pi-hosted.com/",children:"here"})," to read more."]}),"\n",(0,o.jsx)(t.h3,{id:"installation-of-portainer",children:"Installation of Portainer"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Run install-docker.sh, to install docker if not already, and add the current user to the docker usergroup."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"wget -qO- https://raw.githubusercontent.com/pi-hosted/pi-hosted/master/install_docker.sh | bash\n"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"After a reboot, run install-portainer.sh, to install Portainer.io"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"wget -qO- https://raw.githubusercontent.com/pi-hosted/pi-hosted/master/install_portainer.sh | bash\n"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Login to Portainer to update the App Template."}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Goto pi-ip:9000. Setup Username and Password and login"}),"\n",(0,o.jsxs)(t.li,{children:["Click Settings, in the bottom-left corner, and paste the below Portainer v2 json file link into the",(0,o.jsx)(t.br,{}),"\n","\u201cApp Templates\u201d box.","\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"https://raw.githubusercontent.com/pi-hosted/pi-hosted/master/template/portainer-v2-arm64.json\n"})}),"\n"]}),"\n",(0,o.jsx)(t.li,{children:"You\u2019re done! Now you can  deploy applications!"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"installation-of-nextcloud",children:"Installation of Nextcloud"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:'Login to Portainer pi-ip:9000 and go to Home >> Environments >> click on "Local"'}),"\n",(0,o.jsx)("img",{src:"/img/nextcloud1.png",alt:"Sample Image",width:"600",height:"300"}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"In the left box, select Templates >> Application and search for NextCloud and select it"}),"\n",(0,o.jsx)("img",{src:"/img/nextcloud2.png",alt:"Sample Image",width:"600",height:"300"}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Fill the fields, for example"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Database_password -> pa$$word"}),"\n",(0,o.jsx)(t.li,{children:"MySQL_root_password -> pa$$word"}),"\n",(0,o.jsx)(t.li,{children:"port -> 5443"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Click on Actions >> Deploy the Stack. Wait for deployment to complete"}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Goto Environments > Containers, you will see 2 Nextcloud containers running"}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Login to Nextcloud GUI pi-ip",":port",", for example ",(0,o.jsx)(t.a,{href:"https://rpi3:5443",children:"https://rpi3:5443"})," and create an admin account"]}),"\n",(0,o.jsx)("img",{src:"/img/nextcloud3.png",alt:"Sample Image",width:"700",height:"500"}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Choose the required apps (try to keep it minimal)"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"setup-rgw-s3-as-primary-storage",children:"Setup RGW S3 as primary storage"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Create a new bucket from Ceph dashboard. Refer  ",(0,o.jsx)(t.a,{href:"https://karunjosy.github.io/docs/CephBox/CephBox%20-%20DIY%20setup/Installing%20Ceph%20Cluster#creating-an-rgw-user-and-bucket",children:"here"})]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"From the Raspberry Pi node, open Nextcloud config file, the path is"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"/portainer/Files/AppData/Config/Nextcloud/Config/www/nextcloud/config/config.php\n"})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Add below configuration to the file, replace the RGW endpoint and bucket details as required"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"'objectstore' => [\n    'class' => '\\\\OC\\\\Files\\\\ObjectStore\\\\S3',\n    'arguments' => [\n      'bucket' => 'bucketname',\n      'hostname' => 'IP',\n      'key' => 'access_key',\n      'secret' => 'secret_key!',\n      'port' => port,\n      'use_ssl' => false,\n      'use_path_style' => true,\n    ],\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["You can find a sample config.php ",(0,o.jsx)(t.a,{href:"https://github.com/karunjosy/CephBox/tree/main/nextcloud_with_ceph",children:"here"})]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Restart the Nextcloud container from Portainer GUI and that's it!"}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Upload files and verify it's getting added to RGW backend."}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>l});var o=n(6540);const s={},i=o.createContext(s);function r(e){const t=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:t},e.children)}}}]);
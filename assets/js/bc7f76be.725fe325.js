"use strict";(self.webpackChunkkarunjosyin=self.webpackChunkkarunjosyin||[]).push([[1745],{8533:(e,n,s)=>{s.r(n),s.d(n,{Highlight:()=>h,assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>c});var i=s(4848),o=s(8453);const t={},l=void 0,r={id:"CephBox/CephBox - DIY setup/Installing Ceph Cluster",title:"Installing Ceph Cluster",description:"Cephadm orchestrator module is used for the ceph cluster installation.",source:"@site/docs/CephBox/CephBox - DIY setup/Installing Ceph Cluster.md",sourceDirName:"CephBox/CephBox - DIY setup",slug:"/CephBox/CephBox - DIY setup/Installing Ceph Cluster",permalink:"/docs/CephBox/CephBox - DIY setup/Installing Ceph Cluster",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CephBox/CephBox - DIY setup/Installing Ceph Cluster.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Setting up Raspberry Pi OS",permalink:"/docs/CephBox/CephBox - DIY setup/Setting up Raspberry Pi OS"},next:{title:"Setup Ente Photos app",permalink:"/docs/CephBox/CephBox - DIY setup/Setup Ente Photos app"}},d={},h=({children:e,color:n})=>(0,i.jsx)("span",{style:{backgroundColor:n,borderRadius:"2px",color:"#fff",padding:"0.2rem"},children:e}),c=[{value:"Manual Method",id:"manual-method",level:2},{value:"Installing Cephadm",id:"installing-cephadm",level:3},{value:"Installing ceph-common repo",id:"installing-ceph-common-repo",level:3},{value:"Bootstrapping Ceph Cluster",id:"bootstrapping-ceph-cluster",level:3},{value:"Single node bootstrap example**",id:"single-node-bootstrap-example",level:4},{value:"Normal Installation** (Creating Ceph cluster with 2 or more nodes)",id:"normal-installation-creating-ceph-cluster-with-2-or-more-nodes",level:4},{value:"Deploying RADOSGW service for S3",id:"deploying-radosgw-service-for-s3",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://docs.ceph.com/en/latest/cephadm/install/#distribution-specific-installations",children:"Cephadm orchestrator"})," module is used for the ceph cluster installation."]})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"ceph-common package for Ceph Reef or Squid is not available for Debian 12.7 ARM64 OS.\nWe can install a lower version(pacific) or stick to cephadm shell to monitor and administer the Ceph cluster"})}),"\n",(0,i.jsx)(n.admonition,{title:"Automated installation method",type:"tip",children:(0,i.jsxs)(n.p,{children:["We have automated Ceph Cluster installation in a bash script. You may run the script directly instead of doing the below steps manually: ",(0,i.jsx)(n.a,{href:"https://github.com/karunjosy/CephDrive/blob/main/scripts/install.sh",children:"Install Ceph Cluster"})]})}),"\n",(0,i.jsx)(n.h2,{id:"manual-method",children:"Manual Method"}),"\n",(0,i.jsx)(n.h3,{id:"installing-cephadm",children:"Installing Cephadm"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Install podman, lvm2 and chrony"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# apt-get -y install lvm2 podman chrony\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["To install ",(0,i.jsx)(h,{color:"#1877F2",children:"Ceph Squid version (19.2.0)"}),", download it's associated  cephadm binary and make it executable"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# cd /sbin/ && \ncurl --silent --remote-name --location https://download.ceph.com/rpm-squid/el9/noarch/cephadm\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'# chmod +x /sbin/cephadm\n# echo "export PATH=/sbin:/bin:/usr/bin:/usr/sbin:/usr/local/sbin:/usr/local/bin" >> ~/.bashrc\n# source ~/.bashrc\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Add repo"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# cephadm add-repo --version 19.2.0\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Pull the latest ceph image from Quay"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# podman pull quay.io/ceph/ceph:v19.2.0\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"installing-ceph-common-repo",children:"Installing ceph-common repo"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"ceph-common package for Ceph Reef or Squid is not available for Debian 12.7 ARM64 OS. We can install a lower version(pacific) or stick to cephadm shell to monitor and administer the Ceph clusteras\ncephadm is backward compatible for most of the features. (You can safely skip this step)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# apt-get install ceph-common=16.2.11+ds-2 python3-ceph-argparse=16.2.11+ds-2 python3-ceph-common=16.2.11+ds-2 python3-cephfs=16.2.11+ds-2 -y\n# cephadm install ceph-common\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"bootstrapping-ceph-cluster",children:"Bootstrapping Ceph Cluster"}),"\n",(0,i.jsx)(n.h4,{id:"single-node-bootstrap-example",children:"Single node bootstrap example**"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Use this method only if you are testing Ceph Cluster on a single node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# cephadm --image quay.io/ceph/ceph:v19.2.0 bootstrap --mon-ip  <replace_with_node_IP> --single-host-defaults\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"normal-installation-creating-ceph-cluster-with-2-or-more-nodes",children:"Normal Installation** (Creating Ceph cluster with 2 or more nodes)"}),"\n",(0,i.jsxs)(n.admonition,{title:"Prerequisites",type:"warning",children:[(0,i.jsx)(n.p,{children:"All Hosts must have the below Requirements installed. Hosts without all the necessary requirements will fail to be added to the cluster."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:" # apt-get -y install lvm2 podman chrony\n"})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Run the Bootstrap command from the first node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:" # cephadm --image quay.io/ceph/ceph:v19.2.0 bootstrap  --mon-ip  <replace_with_node_IP>\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Once bootstrap is complete you will see messages in terminal which will include the Dashboard URL and login credentials, for example;"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Ceph Dashboard is now available at:\n\n    URL: https://rpi3:8443/\n    User: admin\n    Password: 9pbxkxkxkx\n"})}),"\n",(0,i.jsx)(h,{color:"#1877F2",children:"Important : Login to the Dashboard and reset the password"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check the Ceph status"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# cephadm shell ceph status\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["From here on, please note that the ceph commands are run from inside Cephadm shell.\nTo log into the Cephadm shell:\n",(0,i.jsx)(n.code,{children:"# cephadm shell"})]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Add additional host to the cluster"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Enable root ssh access in the second node","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# nano /etc/ssh/sshd_config\nPermitRootLogin  yes\n# systemctl restart ssh\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Install the cluster\u2019s public SSH key in the new host\u2019s root user\u2019s authorized_keys file:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# ssh-copy-id -f -i /etc/ceph/ceph.pub root@*<new-host>*\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Tell Ceph that the new node is part of the cluster:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# ceph orch host add *<newhost>* [*<ip>*] \n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Add OSDs to the cluster"})}),"\n",(0,i.jsxs)(n.admonition,{title:"Prerequisites",type:"warning",children:[(0,i.jsx)(n.p,{children:"Attach one or more additional Raw disks (HDD, SSD or NVMes) to the nodes.\nIt should be wiped clean and should have no partitions or filesystem header:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"To zap a disk using ceph orch command: `# ceph orch device zap <hostname> </dev/sdX> --force`\nTo wipe a disk using wipefs: `# wipefs /dev/sdX -a`\n"})}),(0,i.jsx)(n.p,{children:"Oftentimes, you would need to do them both."})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["List the ",(0,i.jsx)(n.strong,{children:"available"})," devices to deploy OSDs:\n(Look for ",(0,i.jsx)(n.em,{children:"Available : Yes"}),")","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# ceph orch device ls --wide --refresh\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Add the OSDs","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# ceph orch daemon add osd <hostname>:/<devicename>\n"})}),"\n","For example:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# ceph orch daemon add osd rpi1:/dev/sda \n# ceph orch daemon add osd rpi2:/dev/sda\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Verify the OSD status","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# ceph osd tree\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Note",type:"tip",children:(0,i.jsxs)(n.p,{children:["If there are any errors in the ",(0,i.jsx)(n.code,{children:"ceph status"})," or ",(0,i.jsx)(n.code,{children:"ceph health detail"})," go to Troubleshooting doc."]})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"deploying-radosgw-service-for-s3",children:"Deploying RADOSGW service for S3"}),"\n",(0,i.jsx)(n.p,{children:"RGW service can be easily added from dashboard :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Login to Dashboard ",(0,i.jsx)(n.code,{children:"https://<IP>:8443"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Go to  ",(0,i.jsx)(n.em,{children:"Administration"})," >> ",(0,i.jsx)(n.em,{children:"Services"})," >> ",(0,i.jsx)(n.em,{children:"+ Create"})," and enter the details"]}),"\n",(0,i.jsx)("img",{src:"/img/rgwservice.png",alt:"Sample Image",width:"800",height:"500"}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var i=s(6540);const o={},t=i.createContext(o);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);